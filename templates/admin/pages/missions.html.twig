{% extends 'admin/index.html.twig' %}

{% block title %} {{ parent() }} - Missions {% endblock %}

{% block content %}
  {% if app.request.get("_route") == "create_mission" or app.request.get("_route") == "update_mission" %}
    {% if form is defined %}
    {{ form_start(form) }}    
      <div class="my-custom-class-for-errors">
          {{ form_errors(form) }}
      </div>
      <div class="d-flex flex-row align-items-center justify-content-center ">
        
        <div class="w-25 m-3">
          <div class="form-control text-center m-1">
            {{ form_label(form.title) }}
            {{ form_widget(form.title, { 'attr': {'class': 'text-center'}}) }}        
            <div class="form-error">
                {{ form_errors(form.title) }}
            </div>
          </div>
          <div class="form-control text-center m-1">
            {{ form_label(form.codeName) }}
            {{ form_widget(form.codeName, { 'attr': {'class': 'text-center'}}) }}        
            <div class="form-error">
                {{ form_errors(form.codeName) }}
            </div>
          </div>          
          <div class="form-control text-center m-1">
            {{ form_label(form.missionType) }}
            {{ form_widget(form.missionType, { 'attr': {'class': 'text-center'}}) }}        
            <div class="form-error">
                {{ form_errors(form.missionType) }}
            </div>
          </div>
          <div class="form-control text-center m-1">
            {{ form_label(form.status) }}
            {{ form_widget(form.status, { 'attr': {'class': 'text-center'}}) }}        
            <div class="form-error">
                {{ form_errors(form.status) }}
            </div>
          </div>          
          <div class="form-control text-center m-1">
            {{ form_label(form.country) }}
            {{ form_widget(form.country, { 'attr': {'class': 'text-center'}})}}        
            <div class="form-error">
                {{ form_errors(form.country) }}
            </div>
          </div>
          <div class="form-control text-center m-1">
            {{ form_label(form.speciality) }}
            {{ form_widget(form.speciality, { 'attr': {'class': 'text-center'}}) }}        
            <div class="form-error">
                {{ form_errors(form.speciality) }}
            </div>
          </div>
        </div>
  
        <div class="w-25 m-3">        
          <div class="form-control text-center m-1">
            {{ form_label(form.description) }}
            {{ form_widget(form.description, { 'attr': {'class': 'text-center'}}) }}        
            <div class="form-error">
                {{ form_errors(form.description) }}
            </div>
          </div>        
          <div class="form-control text-center m-1">
            {{ form_label(form.startDate) }}
            {{ form_widget(form.startDate, { 'attr': {'class': 'text-center'}})}}        
            <div class="form-error">
                {{ form_errors(form.startDate) }}
            </div>
          </div>
          <div class="form-control text-center m-1" >
            {{ form_label(form.endDate) }}
            {{ form_widget(form.endDate, { 'attr': {'class': 'text-center'}}) }}        
            <div class="form-error">
                {{ form_errors(form.endDate) }}
            </div>
          </div>
        </div>
  
        <div class="w-25 m-3">
          <div class="form-control text-center m-1">
            {{ form_label(form.agentList,"Liste des agents, choix multiple en maintenant Ctrl") }}
            {{ form_widget(form.agentList, { 'attr': {'class': 'text-center'}}) }}        
            <div class="form-error">
                {{ form_errors(form.agentList) }}
            </div>
          </div>
          <div class="form-control text-center m-1">
            {{ form_label(form.stashList,"Liste des planques, choix multiple en maintenant Ctrl") }}
            {{ form_widget(form.stashList, { 'attr': {'class': 'text-center'}}) }}        
            <div class="form-error">
                {{ form_errors(form.stashList) }}
            </div>
          </div>
          <div class="form-control text-center m-1">
            {{ form_label(form.contactList,"Liste des contacts, choix multiple en maintenant Ctrl") }}
            {{ form_widget(form.contactList, { 'attr': {'class': 'text-center'}}) }}        
            <div class="form-error">
                {{ form_errors(form.contactList) }}
            </div>
          </div>
          <div class="form-control text-center m-1">
            {{ form_label(form.targetList,"Liste des cibles, choix multiple en maintenant Ctrl") }}
            {{ form_widget(form.targetList, { 'attr': {'class': 'text-center'}})}}        
            <div class="form-error">
                {{ form_errors(form.targetList) }}
            </div>
          </div>       
        </div>
  
      </div>
      
      {% if app.request.get("_route") == "create_mission" %}
  
        <div class="d-flex align-items-center justify-content-around ">
          <div class="text-center m-4 ">
            <a href="/admin">
              <input type="button" value="Liste des missions" class="btn btn-primary mt-2 w-auto" >
            </a>            
          </div>
          <div class="text-center mb-4 ">
            <input type="submit" value="Ajouter une mission" class="btn btn-success w-auto">
          </div> 
        </div>
  
      {% else %}
  
        <div class="text-center m-4 ">
          <input type="submit" value="Enregistrer la modification" class="btn btn-warning mt-2 w-auto">
        </div>
            
      {% endif %}
  
    {{ form_end(form) }}
    {% endif %}
  {% else %} 

      {% if missions is empty %}

        <h5 class="text-center m-4">Aucune mission trouvée, veuillez en ajouter au moins une SVP.</h5>
        <div class="text-center m-4 ">
          <a href="/admin/missions">
            <input type="button" value="Ajouter une mission" class="btn btn-primary mt-2 w-auto" >
          </a>            
        </div>

      {% else %}    
      
        {# searchbar #}
        <div class="searchBar">
          <label class="label" for="searchBar">Rechercher une mission</label>
          <input class="searchField" type="text" id="searchBar" name="searchBar" onkeyup="search_card()"> 
        </div>

        <div class=" d-flex flex-wrap justify-content-center">
          {% for mission in missions %}
  
            <div class="card w-25 missionCard border border-dark fs-5">
              <div class="card-body text-center mission">
                <p class="card-title card-header m-3 fs-4 fw-bold">Nom : {{ mission.title }}</p>
                <div class="m-2">
                  Description : {{ mission.description }} <br>
                </div>                
                <div class="d-flex flex-row align-items-center justify-content-center">
                  <p class="card-text flex-fill m-2 p-1">
                    Nom de code : {{ mission.codeName }} <br>
                    Date de début : {{ mission.startDate |date('Y-m-d H:i:s')  }} <br>
                    Date de fin : {{ mission.endDate |date('Y-m-d H:i:s') }} <br>                  
                    Spécialité : {{ mission.speciality }} <br>
                    Type de la mission : {{ mission.missionType }} <br>
                  </p>
                  <p class="card-text flex-fill m-2 p-1 border-start">
                    Liste des agents :
                      {% for agent in mission.agentList %}
                        {{ agent }} 
                      {% endfor %} . <br>
                    Liste des planques :
                      {% for stash in mission.stashList %}
                        {{ stash }} 
                      {% endfor %} . <br>
                    Liste des contacts :
                      {% for contact in mission.contactList %}
                        {{ contact }} 
                      {% endfor %} . <br>
                    Liste des cibles :
                      {% for target in mission.targetList %}
                        {{ target }} 
                      {% endfor %} . <br>
                    Statut : {{ mission.status }} <br>
                    Pays de la mission : {{ mission.country }} <br>           
                  </p>
                </div>
                <div class="card-footer">
                  <a href="/admin/update_mission/{{mission.id}}" >
                  <input type="button" value="Modifier" class="btn btn-warning m-3 w-auto" >
                  </a>
                  <a href="/admin/delete_mission/{{mission.id}}"  >
                    <input type="button" value="Supprimer" class="btn btn-danger m-3 w-auto" >
                  </a>
                </div>                
              </div>
            </div>
          {% endfor %}
          <div class="text-center mb-4 ">
            <input type="submit" value="Ajouter une mission" class="btn btn-success w-auto">
          </div> 
        </div> 

      {% endif %}  

    {% endif %}

{% endblock %}




